cmake_minimum_required(VERSION 3.18)

set(FMF2_VERSION_MAJOR 0)
set(FMF2_VERSION_MINOR 1)
set(FMF2_VERSION_PATCH 0)
project(fmf2 VERSION ${FMF2_VERSION_MAJOR}.${FMF2_VERSION_MINOR}.${FMF2_VERSION_PATCH})

# Set minimum required C++ version
set(CMAKE_CXX_STANDARD 17 CACHE STRING "The C++ standard to use")
set(CMAKE_CXX_STANDARD_REQUIRED ON)

# If not specified build as release version
if(NOT CMAKE_BUILD_TYPE)
  set(CMAKE_BUILD_TYPE Release)
endif()

# Add Cython debug if in debug mode
if(CMAKE_BUILD_TYPE STREQUAL "Debug")
  set(CYTHON_FLAGS "${CYTHON_FLAGS} --gdb")
endif()

find_package(Cython REQUIRED)
find_package(Python3 REQUIRED COMPONENTS Development NumPy)
find_package(PythonExtensions REQUIRED)

# Add OpenMP support if found
find_package(OpenMP)

# Mark the SYCL backend as optional
find_package(hipSYCL CONFIG)

# Needed for linking Python and libraries generated by this project
set(CMAKE_POSITION_INDEPENDENT_CODE ON)

# Add FMF2 specific options
option(ENABLE_SKIP "Allow CPU code paths to skip iteration if weight is too small" ON)

add_subdirectory(fmf2)
